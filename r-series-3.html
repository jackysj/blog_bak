
<!DOCTYPE html>
<html lang="zh">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="./theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="./theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="./theme/font-awesome/css/font-awesome.min.css">


    <link href="//jacky-sj/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Jacky MSC Atom">


    <link rel="shortcut icon" href="/images/images.ico" type="image/x-icon">
    <link rel="icon" href="/images/images.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />


<meta name="author" content="Jacky Gong" />
<meta name="description" content="R 语言编程 3 - 数据相关2" />
<meta name="keywords" content="r, data science">
<meta property="og:site_name" content="Jacky MSC"/>
<meta property="og:title" content="R语言记录3:数据的导入及复杂操作"/>
<meta property="og:description" content="R 语言编程 3 - 数据相关2"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./r-series-3.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2014-03-09 11:16:00+08:00"/>
<meta property="article:modified_time" content="2017-03-29 20:30:00+08:00"/>
<meta property="article:author" content="./author/jacky-gong.html">
<meta property="article:section" content="R"/>
<meta property="article:tag" content="r"/>
<meta property="article:tag" content="data science"/>
<meta property="og:image" content="/images/images.png">

  <title>Jacky MSC &ndash; R语言记录3:数据的导入及复杂操作</title>

</head>
<body>
  <aside>
    <div>
      <a href=".">
        <img src="/images/images.png" alt="Jacky MSC" title="Jacky MSC">
      </a>
      <h1><a href=".">Jacky MSC</a></h1>

<p>Thoughts and Writings</p>
      <nav>
        <ul class="list">

          <li><a href="https://old.jacky-sj.com/" target="_blank">Old</a></li>
          <li><a href="mailto:jackycodemsc@gmail.com" target="_blank">Email</a></li>
          <li><a href="/about.html" target="_blank">About</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-weibo" href="http://weibo.com/jackycode" target="_blank"><i class="fa fa-weibo"></i></a></li>
        <li><a class="sc-github" href="https://github.com/jackysj" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-rss" href="/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href=".">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="//jacky-sj/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="r-series-3">R语言记录3:数据的导入及复杂操作</h1>
    <p>
          Posted on 2014-03-09 in <a href="./category/r.html">R</a>


    </p>
  </header>


  <div>
    <p><em>“文章原创，转载请注明出处”</em></p>
<hr>
<p>上一节介绍了R语言中常用的数据类型，并且介绍了R语言中对数据的一些简单操作，如创建查看向量或者矩阵等等。今天就介绍一下如何从文件中导入数据，以及对数据进行一些较为复杂的操作。</p>
<h4>一. 读取数据</h4>
<p>R语言读取数据有很多方式，如<code>scan</code>函数，<code>read.table</code>函数等等。我这里还想介绍另外两个函数，<code>read.csv</code>和<code>read.delim</code>函数，因为处理数据，大部分时候遇到的文件是csv文件或者txt文件，而这两个函数可以很好的读取此类型的文件。</p>
<h5>1. <code>scan</code>函数</h5>
<p>首先简单说说<code>scan</code>函数，这个函数在默认的情况下，希望所有输入的数据都是数值型的。<code>scan</code>函数读取的数据必须是同一模式的，如果没有指定参数，scan将从R控制台读取数据，直到遇到一个空白行停止。</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">scan</span><span class="p">()</span></span>
<span class="code-line"><span class="m">1</span><span class="o">:</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span></span>
<span class="code-line"><span class="m">4</span><span class="o">:</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span></span>
<span class="code-line"><span class="m">7</span><span class="o">:</span></span>
<span class="code-line">Read <span class="m">6</span> items</span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span></span>
</pre></div>


<p>也可以通过设定参数，设定读取的数据类型：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> y <span class="o">&lt;-</span> <span class="kp">scan</span><span class="p">(</span>what<span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c1"># 读取字符型数据</span></span>
<span class="code-line"><span class="m">1</span><span class="o">:</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span></span>
<span class="code-line"><span class="m">4</span><span class="o">:</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span></span>
<span class="code-line"><span class="m">7</span><span class="o">:</span></span>
<span class="code-line">Read <span class="m">6</span> items</span>
<span class="code-line"><span class="o">&gt;</span> y</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;4&quot;</span></span>
</pre></div>


<p>也可以直接读取一个同一模式的数据文件：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> z <span class="o">&lt;-</span> <span class="kp">scan</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span></span>
<span class="code-line">Read <span class="m">9</span> items</span>
<span class="code-line"><span class="o">&gt;</span> z</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span></span>
</pre></div>


<p>其中<code>example.txt</code>的内容如下：</p>
<div class="highlight"><pre><span class="code-line"><span></span>1   2   3</span>
<span class="code-line">4   5   6</span>
<span class="code-line">7   8   9</span>
</pre></div>


<p>注意最后留一个空白行，以便R读取数据时可以找到终止位置(否则会出现<code>warning</code>)。</p>
<h5>2. <code>read.table</code>函数</h5>
<p>顾名思义，<code>read.table</code>函数即是以<strong>数据框</strong>的格式在R中读取数据。这里就涉及到一个新的概念，<strong>数据框</strong>。前一节我们提到过，可以使用列表和数据框去存储具有不同模式的数据。<strong>数据框</strong>可以存储具有相同长度的变量，并且在统计中，其每一行就是样本的一个观测值，有多少行就有多少次观测。我们可以使用<code>data.frame</code>函数来生成一个数据框：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> name <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;Li&quot;</span><span class="p">,</span> <span class="s">&quot;Wang&quot;</span><span class="p">,</span> <span class="s">&quot;Sun&quot;</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> age <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">21</span><span class="p">,</span> <span class="m">22</span><span class="p">,</span> <span class="m">23</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> Datafr <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>name <span class="o">=</span> name<span class="p">,</span> age <span class="o">=</span> age<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> Datafr</span>
<span class="code-line">  name age</span>
<span class="code-line"><span class="m">1</span>   Li  <span class="m">21</span></span>
<span class="code-line"><span class="m">2</span> Wang  <span class="m">22</span></span>
<span class="code-line"><span class="m">3</span>  Sun  <span class="m">23</span></span>
</pre></div>


<p>此外，数据框还有一个优点：可以在不影响原始数据的情况下，改变数据。比如我想知道，数据里面每个人的年龄比18大多少：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> Datafr2 <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>name <span class="o">=</span> name<span class="p">,</span> age <span class="o">=</span> age<span class="p">,</span> age.u <span class="o">=</span> age<span class="m">-18</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> Datafr2</span>
<span class="code-line">  name age age.u</span>
<span class="code-line"><span class="m">1</span>   Li  <span class="m">21</span>     <span class="m">3</span></span>
<span class="code-line"><span class="m">2</span> Wang  <span class="m">22</span>     <span class="m">4</span></span>
<span class="code-line"><span class="m">3</span>  Sun  <span class="m">23</span>     <span class="m">5</span></span>
</pre></div>


<p>那么如何使用<code>read.table</code>函数呢，看看如下示例：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> example <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> example</span>
<span class="code-line">  V1 V2 V3</span>
<span class="code-line"><span class="m">1</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span></span>
<span class="code-line"><span class="m">2</span>  <span class="m">4</span>  <span class="m">5</span>  <span class="m">6</span></span>
<span class="code-line"><span class="m">3</span>  <span class="m">7</span>  <span class="m">8</span>  <span class="m">9</span></span>
</pre></div>


<p>其中<code>header</code>参数指定数据文件的第一行是否为变量名。当没有变量名时，可以使用参数<code>col.names</code>来指定：</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> example <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> col.names<span class="o">=</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;x1&quot;</span><span class="p">,</span> <span class="s">&quot;x2&quot;</span><span class="p">,</span> <span class="s">&quot;x3&quot;</span><span class="p">))</span></span>
<span class="code-line"><span class="o">&gt;</span> example</span>
<span class="code-line">  x1 x2 x3</span>
<span class="code-line"><span class="m">1</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span></span>
<span class="code-line"><span class="m">2</span>  <span class="m">4</span>  <span class="m">5</span>  <span class="m">6</span></span>
<span class="code-line"><span class="m">3</span>  <span class="m">7</span>  <span class="m">8</span>  <span class="m">9</span></span>
</pre></div>


<p>当然<code>read.table</code>函数读取数据时，可以使用<code>sep=参数</code>指定分隔符。这些可以使用<code>?read.table</code>查看。</p>
<h5>3. <code>read.csv</code>和<code>read.delim</code>函数</h5>
<p>使用方法与<code>read.table</code>函数类似，可以直接读取csv文件和txt文件。</p>
<div class="highlight"><pre><span class="code-line"><span></span>dataCsv <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;example.csv&quot;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span></span>
<span class="code-line">dataTxt <span class="o">&lt;-</span> read.delim<span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span> header<span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span></span>
</pre></div>


<h4>二. 数据操作</h4>
<p>上一节介绍了一些简单的数据操作，这次讲一讲较为复杂的数据操作。</p>
<h6>1. 首先从<span class="math">\(-5\)</span>到<span class="math">\(5\)</span>中随机取出不重复的<span class="math">\(10\)</span>个数据(<code>sample</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> y <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">-2</span>  <span class="m">3</span> <span class="m">-3</span>  <span class="m">0</span> <span class="m">-5</span>  <span class="m">5</span>  <span class="m">1</span>  <span class="m">4</span> <span class="m">-1</span>  <span class="m">2</span></span>
<span class="code-line"><span class="o">&gt;</span> y</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">-1</span>  <span class="m">3</span> <span class="m">-3</span>  <span class="m">1</span> <span class="m">-4</span>  <span class="m">5</span>  <span class="m">0</span>  <span class="m">2</span> <span class="m">-5</span> <span class="m">-2</span></span>
</pre></div>


<h6>2. 判断<span class="math">\(x\)</span>中的数据是否大于<span class="math">\(0\)</span>(<code>all</code>和<code>any</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x<span class="o">&gt;</span><span class="m">0</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">all</span><span class="p">(</span>x<span class="o">&gt;</span><span class="m">0</span><span class="p">)</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">any</span><span class="p">(</span>x<span class="o">&gt;</span><span class="m">0</span><span class="p">)</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">TRUE</span></span>
</pre></div>


<h6>3. 试试更多的逻辑运算(<code>&amp;, |, !</code>)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&gt;</span> <span class="m">0</span> <span class="o">&amp;</span> y <span class="o">&gt;</span> <span class="m">0</span></span>
<span class="code-line">     <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span></span>
<span class="code-line"><span class="o">&gt;</span> x <span class="o">&gt;</span> <span class="m">0</span> <span class="o">|</span> y <span class="o">&gt;</span> <span class="m">0</span></span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="o">!</span><span class="p">(</span>x<span class="o">&gt;</span><span class="m">0</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span></span>
</pre></div>


<h6>4. 找出<span class="math">\(x\)</span>与<span class="math">\(y\)</span>相等的元素(<code>which</code>函数):</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">==</span> y</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span>  <span class="kc">TRUE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span> <span class="kc">FALSE</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">which</span><span class="p">(</span>x <span class="o">==</span> y<span class="p">)</span> <span class="c1"># 取出满足条件的位置</span></span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">2</span> <span class="m">3</span> <span class="m">6</span></span>
</pre></div>


<h6>5. 从<span class="math">\(-5\)</span>到<span class="math">\(5\)</span>中随机取出允许重复的<span class="math">\(10\)</span>个数据(<code>sample</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> z <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> z</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">4</span> <span class="m">-4</span> <span class="m">-1</span> <span class="m">-2</span>  <span class="m">4</span>  <span class="m">5</span> <span class="m">-3</span> <span class="m">-3</span>  <span class="m">1</span>  <span class="m">2</span></span>
</pre></div>


<h6>6. 取出<span class="math">\(z\)</span>中不同的元素(<code>unique</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> z.unique <span class="o">&lt;-</span> <span class="kp">unique</span><span class="p">(</span>z<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> z.unique</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">4</span> <span class="m">-4</span> <span class="m">-1</span> <span class="m">-2</span>  <span class="m">5</span> <span class="m">-3</span>  <span class="m">1</span>  <span class="m">2</span></span>
</pre></div>


<h6>7. 生成存在缺失数据的一列数据(<code>NA</code>)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x.na <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="kc">NA</span><span class="p">,</span> <span class="m">3</span><span class="o">:</span><span class="m">5</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> x.na</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span>  <span class="m">4</span>  <span class="m">5</span> <span class="kc">NA</span>  <span class="m">2</span> <span class="kc">NA</span>  <span class="m">3</span>  <span class="m">4</span>  <span class="m">5</span></span>
</pre></div>


<h6>8. 对<span class="math">\(x\)</span>求和(<code>is.na</code>函数):</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> <span class="kp">sum</span><span class="p">(</span>x.na<span class="p">)</span> <span class="c1"># 带着缺失数据计算</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="kc">NA</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">sum</span><span class="p">(</span><span class="kp">is.na</span><span class="p">(</span>x.na<span class="p">))</span> <span class="c1"># 统计缺失数据的个数</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">2</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">sum</span><span class="p">(</span>x.na<span class="p">,</span> na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="c1"># 剔除缺失数据后求和</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">29</span></span>
</pre></div>


<h6>9. 向变量<span class="math">\(x\)</span>中添加数据(<code>append</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">append</span><span class="p">(</span>x<span class="p">,</span> <span class="kp">sample</span><span class="p">(</span><span class="m">-5</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">-2</span>  <span class="m">3</span> <span class="m">-3</span>  <span class="m">0</span> <span class="m">-5</span>  <span class="m">5</span>  <span class="m">1</span>  <span class="m">4</span> <span class="m">-1</span>  <span class="m">2</span> <span class="m">-1</span> <span class="m">-5</span></span>
</pre></div>


<h6>10. 更改<span class="math">\(x\)</span>的数据类型(<code>as.character</code>,<code>as.factor</code>,<code>as.numeric</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">as.character</span><span class="p">(</span>x<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;2&quot;</span>  <span class="s">&quot;8&quot;</span>  <span class="s">&quot;3&quot;</span>  <span class="s">&quot;5&quot;</span>  <span class="s">&quot;4&quot;</span>  <span class="s">&quot;10&quot;</span> <span class="s">&quot;6&quot;</span>  <span class="s">&quot;9&quot;</span>  <span class="s">&quot;1&quot;</span>  <span class="s">&quot;7&quot;</span>  <span class="s">&quot;1&quot;</span>  <span class="s">&quot;4&quot;</span></span>
<span class="code-line"><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span>x<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">2</span>  <span class="m">8</span>  <span class="m">3</span>  <span class="m">5</span>  <span class="m">4</span>  <span class="m">10</span> <span class="m">6</span>  <span class="m">9</span>  <span class="m">1</span>  <span class="m">7</span>  <span class="m">1</span>  <span class="m">4</span></span>
<span class="code-line">Levels<span class="o">:</span> <span class="m">1</span> <span class="m">10</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span></span>
<span class="code-line"><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">as.character</span><span class="p">(</span>x<span class="p">))</span> <span class="c1"># 如果一组因子变量是用数字表示，一般先将数字因子转换成字符后再转换成数值。</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"> <span class="p">[</span><span class="m">1</span><span class="p">]</span>  <span class="m">2</span>  <span class="m">8</span>  <span class="m">3</span>  <span class="m">5</span>  <span class="m">4</span> <span class="m">10</span>  <span class="m">6</span>  <span class="m">9</span>  <span class="m">1</span>  <span class="m">7</span>  <span class="m">1</span>  <span class="m">4</span></span>
</pre></div>


<h6>11. 数据类型更改(<code>unlist</code>,<code>as.data.frame</code>)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> myList <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span></span>
<span class="code-line"><span class="o">&gt;</span> myList<span class="o">$</span>x1 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> myList<span class="o">$</span>x2 <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">6</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> myList</span>
<span class="code-line"><span class="o">$</span>x1</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">$</span>x2</span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="m">2</span> <span class="m">4</span> <span class="m">6</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1"># unlist</span></span>
<span class="code-line"><span class="o">&gt;</span> uList <span class="o">&lt;-</span> <span class="kp">unlist</span><span class="p">(</span>myList<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> uList</span>
<span class="code-line">x11 x12 x13 x21 x22 x23</span>
<span class="code-line">  <span class="m">1</span>   <span class="m">2</span>   <span class="m">3</span>   <span class="m">2</span>   <span class="m">4</span>   <span class="m">6</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1"># matrix</span></span>
<span class="code-line"><span class="o">&gt;</span> mList <span class="o">&lt;-</span> <span class="kt">matrix</span><span class="p">(</span>uList<span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> mList</span>
<span class="code-line">     <span class="p">[,</span><span class="m">1</span><span class="p">]</span> <span class="p">[,</span><span class="m">2</span><span class="p">]</span> <span class="p">[,</span><span class="m">3</span><span class="p">]</span></span>
<span class="code-line"><span class="p">[</span><span class="m">1</span><span class="p">,]</span>    <span class="m">1</span>    <span class="m">2</span>    <span class="m">3</span></span>
<span class="code-line"><span class="p">[</span><span class="m">2</span><span class="p">,]</span>    <span class="m">2</span>    <span class="m">4</span>    <span class="m">6</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1"># dataframe</span></span>
<span class="code-line"><span class="o">&gt;</span> dfList <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span>mList<span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> dfList</span>
<span class="code-line">  V1 V2 V3</span>
<span class="code-line"><span class="m">1</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span></span>
<span class="code-line"><span class="m">2</span>  <span class="m">2</span>  <span class="m">4</span>  <span class="m">6</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">colnames</span><span class="p">(</span>dfList<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;x1&quot;</span><span class="p">,</span> <span class="s">&quot;x2&quot;</span><span class="p">,</span> <span class="s">&quot;x3&quot;</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> dfList</span>
<span class="code-line">  x1 x2 x3</span>
<span class="code-line"><span class="m">1</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span></span>
<span class="code-line"><span class="m">2</span>  <span class="m">2</span>  <span class="m">4</span>  <span class="m">6</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">rownames</span><span class="p">(</span>dfList<span class="p">)</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;o1&quot;</span><span class="p">,</span> <span class="s">&quot;o2&quot;</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> dfList</span>
<span class="code-line">   x1 x2 x3</span>
<span class="code-line">o1  <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span></span>
<span class="code-line">o2  <span class="m">2</span>  <span class="m">4</span>  <span class="m">6</span></span>
</pre></div>


<h6>12. 按条件整理计算数据(<code>table</code>,<code>tapply</code>,<code>by</code>,<code>aggregate</code>函数)：</h6>
<div class="highlight"><pre><span class="code-line"><span></span><span class="o">&gt;</span> x <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span></span>
<span class="code-line"><span class="o">&gt;</span> x<span class="o">$</span>a <span class="o">&lt;-</span> <span class="kp">sample</span><span class="p">(</span><span class="m">-10</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span></span>
<span class="code-line"><span class="o">&gt;</span> x<span class="o">$</span>b <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span><span class="kp">sample</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span></span>
<span class="code-line"><span class="o">&gt;</span> x<span class="o">$</span><span class="kt">c</span> <span class="o">&lt;-</span> <span class="kp">as.factor</span><span class="p">(</span><span class="kp">sample</span><span class="p">(</span><span class="m">-3</span><span class="o">:</span><span class="m">-1</span><span class="p">,</span> <span class="m">20</span><span class="p">,</span> replace<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span></span>
<span class="code-line"><span class="o">&gt;</span> x</span>
<span class="code-line"></span>
<span class="code-line"><span class="c1"># 统计因子出现的频数</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">table</span><span class="p">(</span>x<span class="o">$</span>b<span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"> <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span>  <span class="m">4</span></span>
<span class="code-line"> <span class="m">5</span>  <span class="m">3</span>  <span class="m">1</span> <span class="m">11</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">table</span><span class="p">(</span>x<span class="o">$</span><span class="kt">c</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="m">-3</span> <span class="m">-2</span> <span class="m">-1</span></span>
<span class="code-line"> <span class="m">9</span>  <span class="m">7</span>  <span class="m">4</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">table</span><span class="p">(</span>x<span class="o">$</span>b<span class="p">,</span> x<span class="o">$</span><span class="kt">c</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line">    <span class="m">-3</span> <span class="m">-2</span> <span class="m">-1</span></span>
<span class="code-line">  <span class="m">1</span>  <span class="m">1</span>  <span class="m">3</span>  <span class="m">1</span></span>
<span class="code-line">  <span class="m">2</span>  <span class="m">1</span>  <span class="m">2</span>  <span class="m">0</span></span>
<span class="code-line">  <span class="m">3</span>  <span class="m">0</span>  <span class="m">1</span>  <span class="m">0</span></span>
<span class="code-line">  <span class="m">4</span>  <span class="m">7</span>  <span class="m">1</span>  <span class="m">3</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1"># 使用tapply，by以及aggregate函数根据不同因子对数据进行计算</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">tapply</span><span class="p">(</span>x<span class="o">$</span>a<span class="p">,</span> x<span class="o">$</span>b<span class="p">,</span> <span class="kp">sum</span><span class="p">)</span></span>
<span class="code-line"> <span class="m">1</span>  <span class="m">2</span>  <span class="m">3</span>  <span class="m">4</span></span>
<span class="code-line"> <span class="m">8</span> <span class="m">11</span>  <span class="m">2</span> <span class="m">-5</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">tapply</span><span class="p">(</span>x<span class="o">$</span>a<span class="p">,</span> x<span class="o">$</span><span class="kt">c</span><span class="p">,</span> <span class="kp">sum</span><span class="p">)</span></span>
<span class="code-line"><span class="m">-3</span> <span class="m">-2</span> <span class="m">-1</span></span>
<span class="code-line"><span class="m">-7</span> <span class="m">16</span>  <span class="m">7</span></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">tapply</span><span class="p">(</span>x<span class="o">$</span>a<span class="p">,</span> <span class="kt">list</span><span class="p">(</span>x<span class="o">$</span>b<span class="p">,</span> x<span class="o">$</span><span class="kt">c</span><span class="p">),</span> <span class="kp">sum</span><span class="p">)</span> <span class="c1"># 可以看到，由于b=2且c=-1的数据不存在，所有计算结果为NA(其它类似)</span></span>
<span class="code-line">  <span class="m">-3</span> <span class="m">-2</span> <span class="m">-1</span></span>
<span class="code-line"><span class="m">1</span> <span class="m">-3</span>  <span class="m">6</span>  <span class="m">5</span></span>
<span class="code-line"><span class="m">2</span>  <span class="m">5</span>  <span class="m">6</span> <span class="kc">NA</span></span>
<span class="code-line"><span class="m">3</span> <span class="kc">NA</span>  <span class="m">2</span> <span class="kc">NA</span></span>
<span class="code-line"><span class="m">4</span> <span class="m">-9</span>  <span class="m">2</span>  <span class="m">2</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">&gt;</span> <span class="kp">by</span><span class="p">(</span>x<span class="o">$</span>a<span class="p">,</span> <span class="kt">list</span><span class="p">(</span>x<span class="o">$</span>b<span class="p">,</span> x<span class="o">$</span><span class="kt">c</span><span class="p">),</span> <span class="kp">sum</span><span class="p">)</span> <span class="c1"># 输出结果太长就不给出了，可以观察一下与tapply输出的区别</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="o">&gt;</span> aggregate<span class="p">(</span>a <span class="o">~</span> b<span class="o">+</span><span class="kt">c</span><span class="p">,</span> x<span class="p">,</span> <span class="kp">sum</span><span class="p">)</span> <span class="c1"># 第一个参数为要计算的量，中间的参数为条件，第三个参数为数据集名称，最后一个为函数</span></span>
<span class="code-line">  b  <span class="kt">c</span>  a</span>
<span class="code-line"><span class="m">1</span> <span class="m">1</span> <span class="m">-3</span> <span class="m">-3</span></span>
<span class="code-line"><span class="m">2</span> <span class="m">2</span> <span class="m">-3</span>  <span class="m">5</span></span>
<span class="code-line"><span class="m">3</span> <span class="m">4</span> <span class="m">-3</span> <span class="m">-9</span></span>
<span class="code-line"><span class="m">4</span> <span class="m">1</span> <span class="m">-2</span>  <span class="m">6</span></span>
<span class="code-line"><span class="m">5</span> <span class="m">2</span> <span class="m">-2</span>  <span class="m">6</span></span>
<span class="code-line"><span class="m">6</span> <span class="m">3</span> <span class="m">-2</span>  <span class="m">2</span></span>
<span class="code-line"><span class="m">7</span> <span class="m">4</span> <span class="m">-2</span>  <span class="m">2</span></span>
<span class="code-line"><span class="m">8</span> <span class="m">1</span> <span class="m">-1</span>  <span class="m">5</span></span>
<span class="code-line"><span class="m">9</span> <span class="m">4</span> <span class="m">-1</span>  <span class="m">2</span></span>
</pre></div>


<h4>三. 小节</h4>
<p>这次我们介绍了R语言如何从外部读取数据，以及对得到的数据如何进行一些复杂点的操作。当然这还不是全部，比如我这里还没有讲到如何将数据集按行按列去进行合并(<code>rbind</code>,<code>cbind</code>函数)等等，这些都可以通过help文档得到。我觉得学习一门语言一定要学会使用<code>help</code>，还有善用Google很重要。</p>
<script type="text/javascript">if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
    var align = "center",
        indent = "0em",
        linebreak = "false";

    if (false) {
        align = (screen.width < 768) ? "left" : align;
        indent = (screen.width < 768) ? "0em" : indent;
        linebreak = (screen.width < 768) ? 'true' : linebreak;
    }

    var mathjaxscript = document.createElement('script');
    var location_protocol = (false) ? 'https' : document.location.protocol;
    if (location_protocol !== 'http' && location_protocol !== 'https') location_protocol = 'https:';
    mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
    mathjaxscript.type = 'text/javascript';
    mathjaxscript.src = location_protocol + '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
    mathjaxscript[(window.opera ? "innerHTML" : "text")] =
        "MathJax.Hub.Config({" +
        "    config: ['MMLorHTML.js']," +
        "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
        "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
        "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
        "    displayAlign: '"+ align +"'," +
        "    displayIndent: '"+ indent +"'," +
        "    showMathMenu: true," +
        "    messageStyle: 'normal'," +
        "    tex2jax: { " +
        "        inlineMath: [ ['\\\\(','\\\\)'] ], " +
        "        displayMath: [ ['$$','$$'] ]," +
        "        processEscapes: true," +
        "        preview: 'TeX'," +
        "    }, " +
        "    'HTML-CSS': { " +
        "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'inherit ! important'} }," +
        "        linebreaks: { automatic: "+ linebreak +", width: '90% container' }," +
        "    }, " +
        "}); " +
        "if ('default' !== 'default') {" +
            "MathJax.Hub.Register.StartupHook('HTML-CSS Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax['HTML-CSS'].FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
            "MathJax.Hub.Register.StartupHook('SVG Jax Ready',function () {" +
                "var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;" +
                "VARIANT['normal'].fonts.unshift('MathJax_default');" +
                "VARIANT['bold'].fonts.unshift('MathJax_default-bold');" +
                "VARIANT['italic'].fonts.unshift('MathJax_default-italic');" +
                "VARIANT['-tex-mathit'].fonts.unshift('MathJax_default-italic');" +
            "});" +
        "}";
    (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
}
</script>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="./tag/r.html">r</a>
      <a href="./tag/data-science.html">data science</a>
    </p>
  </div>


    <div class="addthis_relatedposts_inline">


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jacky-msc';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
</article>

    <footer>
<p>
  &copy; Jacky Gong 2014-2017 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Jacky MSC ",
  "url" : ".",
  "image": "/images/images.png",
  "description": ""
}
</script>

</body>
</html>